<!-- ... existing code ... -->
                try {
                    const pdfBlob = doc.output('blob'); // Generar PDF como Blob
                    const downloadUrl = URL.createObjectURL(pdfBlob); // Crear URL
                    
                    const a = document.createElement('a');
<!-- ... existing code ... -->
                    a.click(); // Simular clic
                    
                    // --- CORRECCIÓN ---
                    // Se aumenta el tiempo de espera. 100ms era muy corto y 
                    // causaba que el archivo se corrompiera (el error que viste).
                    // El navegador revocaba la URL antes de terminar la descarga.
                    // Aumentamos a 5 segundos (5000ms) para ser seguros.
                    setTimeout(() => {
                        URL.revokeObjectURL(downloadUrl);
                        if (document.body.contains(a)) {
                            document.body.removeChild(a);
                        }
                    }, 5000); // <-- Aumentado de 100 a 5000
                    
                    return true; // Indicar éxito

                } catch(e) {
<!-- ... existing code ... -->
